Options +FollowSymLinks
RewriteEngine On

RewriteCond %{HTTP_HOST} projectcloud.ru
RewriteRule ^.*$ http://projectscloud.ru%{REQUEST_URI} [R=301,L]

RewriteCond %{HTTP_HOST} devprom.net
RewriteRule ^.*$ http://devprom.ru%{REQUEST_URI} [R=301,L]

RewriteCond %{HTTP_HOST} pm.devprom.ru
RewriteRule ^.*$ http://devprom.ru%{REQUEST_URI} [R=301,L]

RewriteCond %{HTTP_HOST} projectscloud.ru
RewriteRule ^site.+$ http://devprom.ru [R=301,L]

RewriteCond %{HTTP_HOST} projectscloud.ru
RewriteRule ^(links|polls|projects|about|news|room|rss|news.*|sitemap.*|openid|main|about.*|login|loginfrm|join|restore|restorerequest|command.*|style|styleex|jscripts|images.*)$ /plugins/procloud%{REQUEST_URI} [L,QSA]

RewriteCond %{HTTP_HOST} projectscloud.ru
RewriteRule ^$ /plugins/procloud/main [L,QSA]

RewriteCond %{HTTP_HOST} devprom.ru
RewriteRule ^main|projects$ http://devprom.ru [R=301,L]

RewriteCond %{HTTP_HOST} devprom.ru
RewriteRule ^solutions$ http://devprom.ru/features [R=301,L]

RewriteCond %{HTTP_HOST} devprom.ru
RewriteRule ^blog/?([^/]+)?$ http://devprom.ru/news/$1 [R=301,L]

RewriteCond %{HTTP_HOST} devprom.ru
RewriteRule ^product/([^/]+)$ http://devprom.ru/glossary/$1 [R=301,L]

RewriteCond %{HTTP_HOST} devprom.ru
RewriteRule ^features$ http://devprom.ru [R=301,L]

RewriteCond %{HTTP_HOST} devprom.ru
RewriteCond %{HTTPS} !=on
RewriteRule ^(license) https://%{HTTP_HOST}/$1 [R=301,L,QSA]

RewriteCond %{HTTP_HOST} devprom.ru
RewriteCond %{REQUEST_URI} !/logoff.+
RewriteCond %{REQUEST_URI} !/favico.+
RewriteCond %{REQUEST_URI} !/scripts.+
RewriteCond %{REQUEST_URI} !/module.+
RewriteCond %{REQUEST_URI} !/app/front.+
RewriteCond %{REQUEST_URI} !/cache.+
RewriteCond %{REQUEST_URI} !/co/command.+
RewriteCond %{REQUEST_URI} !/rx
RewriteCond %{REQUEST_URI} !/tags.+
RewriteCond %{REQUEST_URI} !/yandex.+
RewriteRule ^(.*)$ /plugins/procloud/site/devprom%{REQUEST_URI} [L,QSA]

RewriteRule ^atom/([^/]+)/([^/]+)$ /co/command.php?class=atom&entity=$1&project=$2 [L]
RewriteRule ^img/([^/]+)$ /images/$1
RewriteRule ^cache/images/([^/]+)$ /images/$1
RewriteRule ^cache/?$ /cache.php [QSA,L]
RewriteRule ^cache-after/?$ /cache-after.php [QSA,L]
RewriteRule ^module/([^/]+)/([^/]+)/(.+)$ /app/front.php?namespace=$1&module=$2&page=$3 [L,QSA]
RewriteRule ^module/([^/]+)/(.+)$ /app/front.php?namespace=$1&module=$2 [L,QSA]
RewriteRule ^(join-project|recovery|reset|logoff|404|503|500|500\.zip|310|profile|projects.*|menu.*)$ /app/front.php [L,QSA]

RewriteRule ^file/([^/]+)/([^/]+)/([^\.]+).external$ /file/download.php?class=$1&project=$2&id=$3 [L,QSA]
RewriteRule ^file/([^/]+)/([^/]+)/(.+)$ /pm/file.php?class=$1&project=$2&id=$3 [L,QSA]
RewriteRule ^file/([^/]+)/([^/]+)$ /co/file.php?class=$1&id=$2 [L,QSA]

RewriteRule ^rx /static/rx.txt

RewriteRule ^(google[^/]+)/?$ /tags/$1 [L]
RewriteRule ^(yandex[^/]+)/?$ /tags/$1 [L]
RewriteRule ^(robots[^/]+)/?$ /robots/$1 [L]
