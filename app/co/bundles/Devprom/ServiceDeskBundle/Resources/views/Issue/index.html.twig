{% extends '::content.html.twig' %}

{% import "DevpromServiceDeskBundle:Common:macros.html.twig" as macro %}

{% block title %}
    {% trans %} index.title {% endtrans %}
{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ absolute_url('/co/bundles/Devprom/ServiceDeskBundle/public/css/responsive-tables.css') }}" />
{% endblock %}

{% block content -%}
    {% if issues is not empty %}
        <section class="widget">

            <div class="body responsive-table">
                {% if sortDirection == 'asc' %}
                    {% set sortDirectionClass = 'ascending' %}
                    {% set reverseSortDirection = 'desc' %}
                {% else %}
                    {% set sortDirectionClass = 'descending' %}
                    {% set reverseSortDirection = 'asc' %}
                {% endif %}
                <table class="table table-striped table-editable" id="issues-list">
                    <thead>
                        <tr>
                            <th class="no-wrap {% if sortColumn == 'issue.id' %} {{ sortDirectionClass }}{% endif %}" width="10%">
                                <a href="{{ path('issue_list', {'filter':issuesFilter,'sortColumn':'issue.id','sortDirection':reverseSortDirection}) }}">
                                    {{ 'issue_id'|trans }}
                                    <b class="sort-caret"></b>
                                </a>
                            </th>
                            <th class="no-wrap {% if sortColumn == 'issue.caption' %} {{ sortDirectionClass }}{% endif %}">
                                <a href="{{ path('issue_list', {'filter':issuesFilter,'sortColumn':'issue.caption','sortDirection':reverseSortDirection}) }}">
                                    {{ 'issue_caption'|trans }}
                                    <b class="sort-caret"></b>
                                </a>
                            </th>
                            <th class="no-wrap {% if sortColumn == 'severity.id' %} {{ sortDirectionClass }}{% endif %}" width="10%">
                                <a href="{{ path('issue_list', {'filter':issuesFilter,'sortColumn':'severity.id','sortDirection':reverseSortDirection}) }}">
                                    {{ 'issue_severity'|trans }}
                                    <b class="sort-caret"></b>
                                </a>
                            </th>
                            {% if app.request.get('filter') == "company" %}
                            <th class="no-wrap hidden-xs{% if sortColumn == 'issue.authorname' %} {{ sortDirectionClass }}{% endif %}" width="20%">
                            	{{ 'issue_author'|trans }}
                            </th>
                            {% endif %}
                            <th class="no-wrap hidden-xs{% if sortColumn == 'issue.createdAt' %} {{ sortDirectionClass }}{% endif %}" width="20%">
                                <a href="{{ path('issue_list', {'filter':issuesFilter,'sortColumn':'issue.createdAt','sortDirection':reverseSortDirection}) }}">
                                    {{ 'issue_createdAt'|trans }}
                                    <b class="sort-caret"></b>
                                </a>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                    {% set state = '' %}
                    {% for issue in issues %}
                    	{% if state != issue.state.name %}
                    	<tr>
                    		<td class="state-row" colspan="{{ app.request.get('filter') == "company" ? 5 : 4 }}" style="padding-top: 32px;">
                    			<b>{{ issue.state.name|trans }}</b>
                    			{% set state = issue.state.name %}
                    		</td>
                    	</tr>
                    	{% endif %}
                        <tr>
                            <td class="issue-id-cell"  data-title="{{ 'issue_id'|trans }}">
                                {% if issue.issueType != null %}
                            	    <img src="/co/bundles/Devprom/ServiceDeskBundle/public/images/{{ issueTypeIconFilename(issue.issueType.referenceName) }}">&nbsp;
                                {% endif %}
                                <a href="{{ path('issue_show', { 'id': issue.id }) }}">[I-{{ issue.id }}]</a>
                            </td>
                            <td class="issue-caption-cell" data-title="{{ 'issue_caption'|trans }}">
                                <a href="{{ path('issue_show', { 'id': issue.id }) }}">
                                    {{ issue.caption|unescapeHtml }}
                                </a>
                            </td>
                            <td class="centered" data-title="{{ 'issue_severity'|trans|slice(0,7) }}.">
                                {{ macro.priority_badge(issue.severity.name|trans, issue.severity.id) }}
                            </td>
                            {% if app.request.get('filter') == "company" %}
                            <td class="hidden-xs" data-title="{{ 'issue_author'|trans }}">
                                {{ issue.authorname }}
                            </td>
                            {% endif %}
                            <td data-title="{{ 'issue_createdAt'|trans|slice(0,7) }}." class="hidden-xs">{% if issue.createdAt %}{{ issue.createdAt|date('Y-m-d H:i:s') }}{% endif %}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                <a href="{{ path('issue_new') }}" class="btn btn-lg btn-success" id="create-issue-button">
                    <i class="icon-plus"></i> {{ 'issue.add'|trans }}
                </a>
            </div>
        </section>
    {% else %}
        <section class="widget centered">
            <h2>{{ 'index.no.issues'|trans }}</h2>

            <div class="body">

                <a href="{{ path('issue_new') }}" class="btn btn-lg btn-success" id="create-issue-button">
                    <i class="icon-plus"></i> {{ 'issue.add'|trans }}
                </a>

            </div>
            <br>
        </section>

    {% endif %}

{% endblock %}
